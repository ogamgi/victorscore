<div class="comment-zone">
	<form cond="$grant->write_comment && $oDocument->isEnableComment()" action="./" method="post" onsubmit="return procFilter(this, insert_comment)">
		<input type="hidden" name="mid" value="{$mid}" />
		<input type="hidden" name="document_srl" value="{$oDocument->document_srl}" />
		<input type="hidden" name="comment_srl" value="" />
        <input type="hidden" name="content" value="" />
		<div class="comment-write">
			<div class="editor">
				{$oDocument->getCommentEditor()}
			</div>
			<ul class="buttons">
				<li>
					<button type="submit" class="button inline">
						<div class="text">{$lang->cmd_comment_registration}</div>
					</button>
				</li>
			</ul>
		</div>
	</form>
	<div cond="$oDocument->getCommentcount()" class="comment-list">
		<div class="title text">{$lang->comment} <span>{$oDocument->getCommentcount()}</span></div>
		<ul>
			<li loop="$oDocument->getComments() => $key, $comment">
				{@
					// 레벨
					$level = getModel('zmember')->getMemberLevel($comment->get('member_srl'));
				}
				<div class="top">
					<div class="avatar"><img src="../../../../assets/images/level/{$level}.png" /></div>
					<div class="nickname text">{$comment->getNickName()}</div>
					<div class="regdate text">{$comment->getRegdate('Y.m.d H:i')}</div>
				</div>
				<div class="content">
					<!--@if ($comment->status == RX_STATUS_DELETED)-->

					<!--@elseif ($comment->status == RX_STATUS_DELETED_BY_ADMIN)-->
					
					<!--@elseif (!$comment->isAccessible())-->
					
					<!--@else-->
						<div class="text">{$comment->getContent(false)}</div>
					<!--@end-->
				</div>
				<ul class="bottom">
					<li cond="$comment->isGranted() || !$comment->get('member_srl')">
						<a href="{getUrl('act', 'dispBoardModifyComment', 'comment_srl', $comment->comment_srl)}" class="button inline small gray">
							<div class="text">{$lang->cmd_modify}</div>
						</a>
					</li>
					<li cond="$comment->isGranted() || !$comment->get('member_srl')">
						<a href="{getUrl('act', 'dispBoardDeleteComment', 'comment_srl', $comment->comment_srl)}" class="button inline small gray">
							<div class="text">{$lang->cmd_delete}</div>
						</a>
					</li>
				</ul>
			</li>
		</ul>
	</div>
	<ul class="pagination">
		<li>
			<a href="{getUrl('cpage', 1)}#comment">
				<div class="text"><i class="xi-angle-left"></i></div>
			</a>
		</li>
		<block cond="!empty($oDocument->comment_page_navigation)">
			<!--@while ($page_no = $oDocument->comment_page_navigation->getNextPage())-->
				{@
					$last_page = $page_no;
				}
				<li class="active"|cond="$page_no == $page">
					<a href="{getUrl('cpage', $page_no)}#comment">
						<div class="text">{$page_no}</div>
					</a>
				</li>
			<!--@end-->
		</block>
		<block cond="empty($oDocument->comment_page_navigation)">
			<li class="active">
				<a href="#" onclick="return false;">
					<div class="text">1</div>
				</a>
			</li>
		</block>
		<li>
			<a href="{getUrl('cpage',$oDocument->comment_page_navigation->last_page)}#comment">
				<div class="text"><i class="xi-angle-right"></i></div>
			</a>
		</li>
	</ul>
</div>


<!-- COMMENT -->
<div cond="0" class="feedback" id="comment">
	<div class="fbHeader">
		<h2><i class="xi-comment"></i> {$lang->comment} <em>{$oDocument->getCommentcount()}</em></h2>
	</div>
	<ul cond="$oDocument->getCommentcount()" class="fbList">
		<li loop="$oDocument->getComments()=>$key,$comment" class="fbItem"|cond="!$comment->get('depth')" class="fbItem indent indent{($comment->get('depth'))}"|cond="$comment->get('depth')" id="comment_{$comment->comment_srl}">
			<div class="fbMeta">
				<img cond="$comment->getProfileImage()" src="{$comment->getProfileImage()}" alt="Profile" class="profile" />
				<span cond="!$comment->getProfileImage()" class="profile"></span>
				<h3 class="author">
					<a cond="$comment->member_srl <= 0 && $comment->homepage" href="{$comment->getHomepageUrl()}">{$comment->getNickName()}</a>
					<strong cond="$comment->member_srl <= 0 && !$comment->homepage">{$comment->getNickName()}</strong>
					<a cond="$comment->member_srl > 0" href="#popup_menu_area" class="member_{$comment->member_srl}" onclick="return false">{$comment->getNickName()}</a>
				</h3>
				<p class="time">{$comment->getRegdate('Y.m.d H:i')}</p>
			</div>
			<!--@if($comment->status == RX_STATUS_DELETED)-->
				<div class="rhymix_content xe_content deleted">{$lang->msg_deleted_comment}</div>
			<!--@elseif($comment->status == RX_STATUS_DELETED_BY_ADMIN)-->
				<div class="rhymix_content xe_content deleted deleted_by_admin">{$lang->msg_admin_deleted_comment}</div>
			<!--@elseif(!$comment->isAccessible())-->
			<form action="./" method="get" class="rhymix_content xe_content secretForm" onsubmit="return procFilter(this, input_password)">
				<p><label for="cpw_{$comment->comment_srl}">{$lang->msg_is_secret} {$lang->msg_input_password}</label></p>
				<p><input type="password" name="password" id="cpw_{$comment->comment_srl}" class="iText" /><input type="submit" class="btn" value="{$lang->cmd_input}" /></p>
				<input type="hidden" name="mid" value="{$mid}" />
				<input type="hidden" name="page" value="{$page}" />
				<input type="hidden" name="document_srl" value="{$comment->get('document_srl')}" />
				<input type="hidden" name="comment_srl" value="{$comment->get('comment_srl')}" />
			</form>
			<!--@else-->
				{$comment->getContent(false)}
			<!--@end-->
			<div cond="$comment->hasUploadedFiles()" class="fileList">
				<button type="button" class="toggleFile" onclick="jQuery(this).next('ul.files').toggle();"><i class="xi-diskette"></i> {$lang->uploaded_file} [<strong>{$comment->get('uploaded_count')}</strong>]</button>
				<ul class="files">
					<li loop="$comment->getUploadedFiles()=>$key,$file"><a href="{getUrl('')}{$file->download_url}">{$file->source_filename} <span class="fileSize">[File Size:{FileHandler::filesize($file->file_size)}/Download:{number_format($file->download_count)}]</span></a></li>
				</ul>
			</div>
			<p class="action" cond="!$comment->isDeleted()">
				<a href="{getUrl('act','dispBoardVoteLog','target_srl',$comment->comment_srl,'target','comment')}">{$lang->cmd_comment_vote_user}</a>
				<a cond="$comment->getMyVote() === false || $comment->getMyVote() < 0" href="#" onclick="doCallModuleAction('comment','procCommentVoteUp','{$comment->comment_srl}');return false;" class="voted"><i class="xi-thumbs-up"></i>{$lang->cmd_vote}{$comment->get('voted_count')}</a>
				<a cond="$comment->getMyVote() > 0" href="#" onclick="doCallModuleAction('comment','procCommentVoteUpCancel','{$comment->comment_srl}');return false;" class="voted"><i class="xi-thumbs-up"></i>{$lang->cmd_vote}{$comment->get('voted_count')}</a>
				<a cond="$comment->getMyVote() === false || $comment->getMyVote() > 0" href="#" onclick="doCallModuleAction('comment','procCommentVoteDown','{$comment->comment_srl}');return false;" class="voted"><i class="xi-thumbs-up"></i>{$lang->cmd_vote_down}{$comment->get('blamed_count')}</a>
				<a cond="$comment->getMyVote() < 0" href="#" onclick="doCallModuleAction('comment','procCommentVoteDownCancel','{$comment->comment_srl}');return false;" class="voted"><i class="xi-thumbs-up"></i>{$lang->cmd_vote_down}{$comment->get('blamed_count')}</a>
				<a cond="$oDocument->allowComment()" href="{getUrl('act','dispBoardReplyComment','comment_srl',$comment->comment_srl)}" class="reply"><i class="xi-reply"></i> {$lang->cmd_reply}</a>
				<a cond="$comment->isGranted()||!$comment->get('member_srl')" href="{getUrl('act','dispBoardModifyComment','comment_srl',$comment->comment_srl)}" class="modify"><i class="xi-eraser"></i> {$lang->cmd_modify}</a>
				<a cond="$comment->isGranted()||!$comment->get('member_srl')" href="{getUrl('act','dispBoardDeleteComment','comment_srl',$comment->comment_srl)}" class="delete"><i class="xi-trash"></i> {$lang->cmd_delete}</a>
				<a cond="$is_logged" class="comment_{$comment->comment_srl} this" href="#popup_menu_area" onclick="return false">{$lang->cmd_comment_do}</a>
			</p>
			<p class="action" cond="$comment->isDeleted()">
				<a cond="$grant->manager" href="{getUrl('act','dispBoardDeleteComment','comment_srl',$comment->comment_srl)}" class="delete"><i class="xi-trash"></i> {$lang->delete_placeholder}</a>
			</p>
		</li>
	</ul>


    <div cond="$oDocument->comment_page_navigation" class="pagination">
        <a href="{getUrl('cpage',1)}#comment" class="direction prev"><span></span><span></span> {$lang->first_page}</a> 
        <block loop="$page_no=$oDocument->comment_page_navigation->getNextPage()">
			<strong cond="$cpage==$page_no">{$page_no}</strong> 
			<a cond="$cpage!=$page_no" href="{getUrl('cpage',$page_no)}#comment">{$page_no}</a>
        </block>
        <a href="{getUrl('cpage',$oDocument->comment_page_navigation->last_page)}#comment" class="direction next">{$lang->last_page} <span></span><span></span></a>
    </div>


	<form cond="$grant->write_comment && $oDocument->isEnableComment()" action="./" method="post" onsubmit="return procFilter(this, insert_comment)" class="write_comment" id="write_comment">
		<input type="hidden" name="mid" value="{$mid}" />
		<input type="hidden" name="document_srl" value="{$oDocument->document_srl}" />
		<input type="hidden" name="comment_srl" value="" />
        <input type="hidden" name="content" value="" />
        {$oDocument->getCommentEditor()}
        
		<div class="write_author">
			<span class="item" cond="!$is_logged">
				<label for="userName" class="iLabel">{$lang->writer}</label>
				<input type="text" name="nick_name" id="userName" class="iText userName" />
			</span>
			<span class="item" cond="!$is_logged">
				<label for="userPw" class="iLabel">{$lang->password}</label>
				<input type="password" name="password" id="userPw" class="iText userPw" />
			</span>
			<span class="item" cond="!$is_logged">
				<label for="homePage" class="iLabel">{$lang->homepage}</label>
				<input type="text" name="homepage" id="homePage" class="iText homePage" />&nbsp;
			</span>
			<input cond="$is_logged" type="checkbox" name="notify_message" value="Y" id="notify_message" class="iCheck" />
			<label cond="$is_logged" for="notify_message">{$lang->notify}</label>
			<input cond="$module_info->secret=='Y'" type="checkbox" name="is_secret" value="Y" id="is_secret" class="iCheck" />
			<label cond="$module_info->secret=='Y'" for="is_secret">{$lang->secret}</label>
		</div>
		<div class="write_captcha" cond="isset($captcha) && $captcha && $captcha->isTargetAction('comment')">
			{$captcha}
		</div>
		<div style="float:right">
			<button type="submit" class="btn_insert"><i class="xi-message"></i> {$lang->cmd_comment_registration}</button>
		</div>
	
	
	</form>
</div>
<!-- /COMMENT -->
